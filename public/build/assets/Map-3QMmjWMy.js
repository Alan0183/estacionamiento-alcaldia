import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as a}from"./app-BMQbkYCC.js";const R="/api/parking/map-data",A=15e3,x=26,E=36,z=1;function p(t,r,d,c=x,n=E,s=""){return t.map((i,m)=>({num:i,x:r+m*(c+z),y:d,w:c,h:n,suffix:s,slotKey:s?`${i}${s}`:String(i)}))}const M=[...p([1,2,3,4,5,6,7],80,12),...p([8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35],530,12),...[64,65,66].map((t,r)=>({num:t,x:80,y:148+r*34,w:x,h:30,suffix:"",slotKey:String(t)})),...p([63,62,61,60,59],112,148,x,90),...p([58,57,56,55,54,53,52],904,148,x,90),...p([51,50,49,48,47,46,45,44,43,42,41,40,39,38,37,36],1112,148,x,90),...p([139,140,141,142,143,144,145,146,147,148],112,248,x,70,"B"),...p([67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92],430,248,x,70),...p([136,135,134,133,132,131,130,129,128],80,358,x,50,"B"),...p([127,126,125,124,123,122,121,120,119,118,117,116,115,114,113,112,111,110,109,108,107,106,105,104,103,102,101,100,99,98,97,96,95,94,93],330,358,x,50),{num:138,x:56,y:248,w:22,h:70,suffix:"B",slotKey:"138B"},{num:137,x:56,y:358,w:22,h:50,suffix:"B",slotKey:"137B"}],v={libre:{fill:"#0f2d1a",stroke:"#238636",strokeHover:"#2ea043",text:"#3fb950"},ocupado:{fill:"#2d0f0f",stroke:"#da3633",strokeHover:"#f85149",text:"#f85149"},reservado:{fill:"#2d1f00",stroke:"#9e6a03",strokeHover:"#d29922",text:"#d29922"}},S={libre:{bg:"#0f2d1a",color:"#2ea043",border:"#238636",label:"Libre"},ocupado:{bg:"#2d0f0f",color:"#f85149",border:"#da3633",label:"Ocupado"},reservado:{bg:"#2d1f00",color:"#d29922",border:"#9e6a03",label:"Reservado"}};function H({slot:t,info:r,onEnter:d,onMove:c,onLeave:n}){const[s,i]=a.useState(!1),m=r?.estado??"libre",u=v[m]??v.libre;return e.jsxs("g",{style:{cursor:"pointer"},onMouseEnter:y=>{i(!0),d(y,t.slotKey)},onMouseMove:y=>c(y),onMouseLeave:y=>{i(!1),n()},children:[e.jsx("rect",{x:t.x,y:t.y,width:t.w,height:t.h,rx:3,fill:u.fill,stroke:s?u.strokeHover:u.stroke,strokeWidth:s?2:1.5,style:{filter:s?"brightness(1.6)":"none",transition:"filter 0.15s, stroke-width 0.15s"}}),e.jsx("text",{x:t.x+t.w/2,y:t.y+t.h/2-(t.suffix?5:0),fontSize:8,fill:u.text,textAnchor:"middle",dominantBaseline:"middle",fontFamily:"'JetBrains Mono', monospace",style:{pointerEvents:"none",userSelect:"none"},children:t.num}),t.suffix&&e.jsx("text",{x:t.x+t.w/2,y:t.y+t.h/2+8,fontSize:8,fill:u.text,textAnchor:"middle",fontFamily:"'JetBrains Mono', monospace",style:{pointerEvents:"none",userSelect:"none"},children:"B"})]})}function F({visible:t,x:r,y:d,slotKey:c,info:n}){if(!t)return null;const s=n?.estado??"libre",i=S[s]??S.libre;return e.jsxs("div",{style:{position:"fixed",left:r,top:d,background:"#1c2128",border:"1px solid #30363d",borderRadius:10,padding:"14px 18px",pointerEvents:"none",zIndex:1e3,minWidth:210,boxShadow:"0 8px 32px rgba(0,0,0,0.5)",fontFamily:"'Syne', system-ui, sans-serif"},children:[e.jsxs("div",{style:{fontFamily:"monospace",fontSize:11,color:"#8b949e",textTransform:"uppercase",letterSpacing:1,marginBottom:6},children:["CAJÓN #",c]}),e.jsx("div",{style:{fontSize:16,fontWeight:700,color:"#f0f6fc",marginBottom:4},children:s==="libre"?"Disponible":n?.nombre||"—"}),s!=="libre"&&e.jsx("div",{style:{fontFamily:"monospace",fontSize:13,color:"#58a6ff",letterSpacing:2,marginBottom:4},children:s==="ocupado"?n?.placa||"—":n?.notas||"—"}),s==="ocupado"&&n?.phone&&e.jsx("div",{style:{fontSize:13,color:"#58a6ff",marginBottom:6},children:n.phone}),e.jsx("span",{style:{display:"inline-block",fontSize:11,fontWeight:700,padding:"3px 10px",borderRadius:20,textTransform:"uppercase",letterSpacing:1,background:i.bg,color:i.color,border:`1px solid ${i.border}`,marginTop:s==="libre"?8:0},children:i.label})]})}function C(){const[t,r]=a.useState({}),[d,c]=a.useState({libres:0,ocupados:0,reservados:0}),[n,s]=a.useState("idle"),[i,m]=a.useState(""),[u,y]=a.useState({visible:!1,x:0,y:0,slotKey:"",info:null}),b=a.useRef({x:0,y:0}),g=a.useCallback(async()=>{s("loading");try{const o=await fetch(R,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const l=await o.json();r(l);const f=Object.values(l);c({libres:f.filter(h=>h.estado==="libre").length,ocupados:f.filter(h=>h.estado==="ocupado").length,reservados:f.filter(h=>h.estado==="reservado").length}),s("ok"),m(new Date().toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit"}))}catch(o){console.error("[ParkingMap] Error:",o),s("error")}},[]);a.useEffect(()=>{g();const o=setInterval(g,A);return()=>clearInterval(o)},[g]);const j=a.useCallback((o,l)=>{const f=t[l]??{estado:"libre"},h=k(o.clientX,o.clientY);b.current=h,y({visible:!0,...h,slotKey:l,info:f})},[t]),w=a.useCallback(o=>{const l=k(o.clientX,o.clientY);b.current=l,y(f=>f.visible?{...f,...l}:f)},[]),B=a.useCallback(()=>{y(o=>({...o,visible:!1}))},[]),T={idle:"#444c56",loading:"#d29922",ok:"#238636",error:"#da3633"}[n],W=n==="loading"?"pulse 1s infinite":"none";return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;700;800&display=swap');
                @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
                * { box-sizing: border-box; }
            `}),e.jsxs("div",{style:{background:"#0d1117",minHeight:"100vh",padding:24,fontFamily:"'Syne', system-ui, sans-serif",color:"#c9d1d9"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:28,paddingBottom:20,borderBottom:"1px solid #30363d",flexWrap:"wrap",gap:12},children:[e.jsxs("h1",{style:{fontSize:"1.6rem",fontWeight:800,color:"#f0f6fc",margin:0},children:["Parking ",e.jsx("span",{style:{color:"#58a6ff"},children:"MAP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:24,flexWrap:"wrap"},children:[[{color:"#238636",label:`${d.libres} Libres`},{color:"#da3633",label:`${d.ocupados} Ocupados`},{color:"#9e6a03",label:`${d.reservados} Reservados`}].map(({color:o,label:l})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontFamily:"monospace",fontSize:13},children:[e.jsx("div",{style:{width:10,height:10,borderRadius:2,background:o}}),e.jsx("span",{children:l})]},l)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontFamily:"monospace",fontSize:12,color:"#8b949e"},children:[e.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:T,animation:W}}),e.jsxs("span",{children:[n==="loading"&&"Actualizando…",n==="ok"&&`Actualizado ${i}`,n==="error"&&"Sin conexión",n==="idle"&&"—"]})]})]})]}),e.jsx("div",{style:{background:"#161b22",border:"1px solid #30363d",borderRadius:12,padding:20,overflowX:"auto"},children:e.jsxs("svg",{viewBox:"0 0 1560 430",xmlns:"http://www.w3.org/2000/svg",style:{display:"block",minWidth:1400},children:[e.jsx("rect",{x:"2",y:"2",width:"50",height:"90",fill:"#161b22",stroke:"#58a6ff",strokeWidth:1.5,rx:4}),e.jsx("text",{x:"27",y:"47",fontSize:9,fontWeight:700,fill:"#58a6ff",textAnchor:"middle",dominantBaseline:"middle",transform:"rotate(-90,27,47)",style:{letterSpacing:2,fontFamily:"Syne, sans-serif"},children:"ENTRADA"}),e.jsx("text",{x:"380",y:"120",fontSize:10,fill:"#444c56",textAnchor:"middle",fontFamily:"'JetBrains Mono', monospace",style:{letterSpacing:2},children:"PASILLO CENTRAL"}),e.jsx("rect",{x:"55",y:"2",width:"1498",height:"420",fill:"none",stroke:"#21262d",strokeWidth:1.5,rx:4}),e.jsx("line",{x1:"55",y1:"230",x2:"1553",y2:"230",stroke:"#21262d",strokeWidth:1,strokeDasharray:"4,4"}),e.jsx("line",{x1:"55",y1:"340",x2:"1553",y2:"340",stroke:"#21262d",strokeWidth:1,strokeDasharray:"4,4"}),M.map(o=>e.jsx(H,{slot:o,info:t[o.slotKey],onEnter:j,onMove:w,onLeave:B},o.slotKey))]})})]}),e.jsx(F,{...u})]})}function k(t,r){return{x:t+16+220>window.innerWidth?t-220-16:t+16,y:r-10+130>window.innerHeight?r-130:r-10}}export{C as default};
